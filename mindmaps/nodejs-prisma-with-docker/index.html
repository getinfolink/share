<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.8.0/styles/default.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.2/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.17.2/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.17.2/dist/index.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"Using Prisma with Node.js <br/>in a Dockerized Environment","children":[{"content":"Create project folder and Installation","children":[{"content":"\n<pre><code class=\"language-sh\">  <span class=\"hljs-built_in\">mkdir</span> -p &lt;project_folder&gt;/backend\n  <span class=\"hljs-built_in\">cd</span> &lt;project_folder&gt;/backend\n\n  npm init -y\n  npm i express prisma @prisma/client\n  npx prisma init\n</code></pre>","children":[],"payload":{"lines":"2,10"}}],"payload":{"lines":"1,2"}},{"content":"Create starter kit","children":[{"content":"\n<p data-lines=\"11,12\"><code>&lt;project_folder&gt;/backend/.env</code></p>","children":[{"content":"\n<pre><code class=\"language-sh\">  DATABASE_URL=<span class=\"hljs-string\">\"postgresql://postgres:postgres@localhost:5432/postgres?schema=public\"</span>\n</code></pre>","children":[],"payload":{"lines":"12,16"}}],"payload":{"lines":"11,16"}},{"content":"\n<p data-lines=\"16,17\"><code>&lt;project_folder&gt;/backend/prisma/schema.prisma</code></p>","children":[{"content":"\n<pre><code class=\"language-js\">  <span class=\"hljs-comment\">// This is your Prisma schema file,</span>\n  <span class=\"hljs-comment\">// learn more about it in the docs: https://pris.ly/d/prisma-schema</span>\n\n  generator client {\n    provider = <span class=\"hljs-string\">\"prisma-client-js\"</span>\n  }\n\n  datasource db {\n    provider = <span class=\"hljs-string\">\"postgresql\"</span>\n    url      = <span class=\"hljs-title function_\">env</span>(<span class=\"hljs-string\">\"DATABASE_URL\"</span>)\n  }\n\n  <span class=\"hljs-comment\">//User with id as int autoincrement, name as string, email as string</span>\n  model <span class=\"hljs-title class_\">User</span> {\n    id    <span class=\"hljs-title class_\">Int</span>    @id @<span class=\"hljs-title function_\">default</span>(<span class=\"hljs-title function_\">autoincrement</span>())\n    name  <span class=\"hljs-title class_\">String</span>\n    email <span class=\"hljs-title class_\">String</span>\n  }\n</code></pre>","children":[],"payload":{"lines":"17,37"}}],"payload":{"lines":"16,37"}},{"content":"\n<p data-lines=\"37,38\"><code>&lt;project_folder&gt;/backend/index.js</code></p>","children":[{"content":"\n<pre><code class=\"language-js\">  <span class=\"hljs-keyword\">const</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'express'</span>);\n  <span class=\"hljs-keyword\">const</span> { <span class=\"hljs-title class_\">PrismaClient</span> } = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'@prisma/client'</span>);\n\n  <span class=\"hljs-keyword\">const</span> prisma = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PrismaClient</span>();\n  <span class=\"hljs-keyword\">const</span> app = <span class=\"hljs-title function_\">express</span>();\n\n  <span class=\"hljs-comment\">//use json</span>\n  app.<span class=\"hljs-title function_\">use</span>(express.<span class=\"hljs-title function_\">json</span>());\n\n  <span class=\"hljs-comment\">//cors</span>\n  app.<span class=\"hljs-title function_\">use</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">req, res, next</span>) =&gt;</span> {\n    res.<span class=\"hljs-title function_\">setHeader</span>(<span class=\"hljs-string\">'Access-Control-Allow-Origin'</span>, <span class=\"hljs-string\">'*'</span>);\n    res.<span class=\"hljs-title function_\">setHeader</span>(<span class=\"hljs-string\">'Access-Control-Allow-Methods'</span>, <span class=\"hljs-string\">'GET, POST, PUT, DELETE'</span>);\n    res.<span class=\"hljs-title function_\">setHeader</span>(<span class=\"hljs-string\">'Access-Control-Allow-Headers'</span>, <span class=\"hljs-string\">'Content-Type, Authorization'</span>);\n    <span class=\"hljs-title function_\">next</span>();\n  });\n\n  <span class=\"hljs-comment\">//test api with error handling</span>\n  app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">'/test'</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">req, res, next</span>) =&gt;</span> {\n    <span class=\"hljs-keyword\">try</span> {\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">200</span>).<span class=\"hljs-title function_\">json</span>({ <span class=\"hljs-attr\">message</span>: <span class=\"hljs-string\">'Success!'</span> });\n    } <span class=\"hljs-keyword\">catch</span> (err) {\n      <span class=\"hljs-title function_\">next</span>(err);\n    }\n  });\n\n  <span class=\"hljs-comment\">//get all users</span>\n  app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">'/users'</span>, <span class=\"hljs-keyword\">async</span> (req, res, next) =&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-keyword\">const</span> users = <span class=\"hljs-keyword\">await</span> prisma.<span class=\"hljs-property\">user</span>.<span class=\"hljs-title function_\">findMany</span>();\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">200</span>).<span class=\"hljs-title function_\">json</span>(users);\n    } <span class=\"hljs-keyword\">catch</span> (err) {\n      <span class=\"hljs-title function_\">next</span>(err);\n    }\n  });\n\n  <span class=\"hljs-comment\">//get user by id</span>\n  app.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">'/users/:id'</span>, <span class=\"hljs-keyword\">async</span> (req, res, next) =&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> prisma.<span class=\"hljs-property\">user</span>.<span class=\"hljs-title function_\">findUnique</span>({\n        <span class=\"hljs-attr\">where</span>: { <span class=\"hljs-attr\">id</span>: <span class=\"hljs-title class_\">Number</span>(req.<span class=\"hljs-property\">params</span>.<span class=\"hljs-property\">id</span>) },\n      });\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">200</span>).<span class=\"hljs-title function_\">json</span>(user);\n    } <span class=\"hljs-keyword\">catch</span> (err) {\n      <span class=\"hljs-title function_\">next</span>(err);\n    }\n  });\n\n  <span class=\"hljs-comment\">//create user</span>\n  app.<span class=\"hljs-title function_\">post</span>(<span class=\"hljs-string\">'/users'</span>, <span class=\"hljs-keyword\">async</span> (req, res, next) =&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> prisma.<span class=\"hljs-property\">user</span>.<span class=\"hljs-title function_\">create</span>({\n        <span class=\"hljs-attr\">data</span>: { ...req.<span class=\"hljs-property\">body</span> },\n      });\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">201</span>).<span class=\"hljs-title function_\">json</span>(user);\n    } <span class=\"hljs-keyword\">catch</span> (err) {\n      <span class=\"hljs-title function_\">next</span>(err);\n    }\n  });\n\n  <span class=\"hljs-comment\">//update user</span>\n  app.<span class=\"hljs-title function_\">put</span>(<span class=\"hljs-string\">'/users/:id'</span>, <span class=\"hljs-keyword\">async</span> (req, res, next) =&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> prisma.<span class=\"hljs-property\">user</span>.<span class=\"hljs-title function_\">update</span>({\n        <span class=\"hljs-attr\">where</span>: { <span class=\"hljs-attr\">id</span>: <span class=\"hljs-title class_\">Number</span>(req.<span class=\"hljs-property\">params</span>.<span class=\"hljs-property\">id</span>) },\n        <span class=\"hljs-attr\">data</span>: { ...req.<span class=\"hljs-property\">body</span> },\n      });\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">200</span>).<span class=\"hljs-title function_\">json</span>(user);\n    } <span class=\"hljs-keyword\">catch</span> (err) {\n      <span class=\"hljs-title function_\">next</span>(err);\n    }\n  });\n\n  <span class=\"hljs-comment\">//delete user</span>\n  app.<span class=\"hljs-title function_\">delete</span>(<span class=\"hljs-string\">'/users/:id'</span>, <span class=\"hljs-keyword\">async</span> (req, res, next) =&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n      <span class=\"hljs-keyword\">const</span> user = <span class=\"hljs-keyword\">await</span> prisma.<span class=\"hljs-property\">user</span>.<span class=\"hljs-title function_\">delete</span>({\n        <span class=\"hljs-attr\">where</span>: { <span class=\"hljs-attr\">id</span>: <span class=\"hljs-title class_\">Number</span>(req.<span class=\"hljs-property\">params</span>.<span class=\"hljs-property\">id</span>) },\n      });\n      res.<span class=\"hljs-title function_\">status</span>(<span class=\"hljs-number\">200</span>).<span class=\"hljs-title function_\">json</span>(user);\n    } <span class=\"hljs-keyword\">catch</span> (err) {\n      <span class=\"hljs-title function_\">next</span>(err);\n    }\n  });\n\n  <span class=\"hljs-comment\">//Start server</span>\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">PORT</span> = process.<span class=\"hljs-property\">env</span>.<span class=\"hljs-property\">PORT</span> || <span class=\"hljs-number\">4000</span>;\n  app.<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-variable constant_\">PORT</span>, <span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">`Server running on port <span class=\"hljs-subst\">${PORT}</span>`</span>));\n</code></pre>","children":[],"payload":{"lines":"38,129"}}],"payload":{"lines":"37,129"}},{"content":"\n<p data-lines=\"129,130\">generate the <code>Prisma schema</code></p>","children":[{"content":"\n<pre><code class=\"language-sh\">  npx prisma generate\n</code></pre>","children":[],"payload":{"lines":"130,133"}}],"payload":{"lines":"129,133"}},{"content":"\n<p data-lines=\"133,134\">Before we <code>dockerize</code> the backend, cat test it.</p>","children":[{"content":"Type in your terminal:","children":[{"content":"\n<pre><code class=\"language-sh\">  node index.js\n</code></pre>","children":[],"payload":{"lines":"135,138"}},{"content":"browser in browser","children":[{"content":"\n<pre><code class=\"language-sh\">  http://localhost:4000/test \n</code></pre>","children":[],"payload":{"lines":"139,144"}}],"payload":{"lines":"138,144"}}],"payload":{"lines":"134,144"}}],"payload":{"lines":"133,144"}}],"payload":{"lines":"10,11"}},{"content":"Make dockerize","children":[{"content":"\n<p data-lines=\"145,146\"><code>.dockerignore</code> and add the following content:</p>","children":[{"content":"\n<pre><code class=\"language-sh\">  **/node_modules\n</code></pre>","children":[],"payload":{"lines":"146,149"}}],"payload":{"lines":"145,149"}},{"content":"\n<p data-lines=\"149,150\"><code>&lt;project_folder&gt;/backend/backend.dockerfile</code></p>","children":[{"content":"\n<pre><code class=\"language-sh\">  FROM node:20\n\n  WORKDIR /app\n\n  COPY package*.json ./\n\n  RUN npm install\n\n  COPY prisma ./prisma\n\n  RUN npx prisma generate\n\n  COPY . .\n\n  EXPOSE 4000\n\n  CMD [<span class=\"hljs-string\">\"node\"</span>, <span class=\"hljs-string\">\"index.js\"</span>]\n</code></pre>","children":[],"payload":{"lines":"150,169"}}],"payload":{"lines":"149,169"}},{"content":"\n<p data-lines=\"169,170\"><code>&lt;project_folder&gt;/compose.yaml</code></p>","children":[{"content":"\n<pre><code class=\"language-sh\">  version: <span class=\"hljs-string\">'3.9'</span>\n\n  services:\n    backend:\n      container_name: backend\n      image: backend\n      build:\n        context: ./backend\n        dockerfile: backend.dockerfile\n      ports:\n        - <span class=\"hljs-string\">\"4000:4000\"</span>\n      environment:\n        - DATABASE_URL=postgresql://postgres:postgres@db:5432/postgres?schema=public\n      depends_on:\n        - db\n    db:\n      container_name: pgdb\n      image: postgres:12\n      restart: always\n      environment:\n        POSTGRES_USER: postgres\n        POSTGRES_PASSWORD: postgres\n        POSTGRES_DB: postgres\n      ports:\n        - <span class=\"hljs-string\">\"5432:5432\"</span>\n      volumes:\n        - pgdata:/var/lib/postgresql/data\n\n  volumes:\n    pgdata: {}\n</code></pre>","children":[],"payload":{"lines":"170,203"}}],"payload":{"lines":"169,203"}},{"content":"\n<p data-lines=\"203,204\">Build the <code>backend</code> image:</p>","children":[{"content":"\n<pre><code class=\"language-sh\">  docker compose build\n</code></pre>","children":[],"payload":{"lines":"204,207"}}],"payload":{"lines":"203,207"}},{"content":"\n<p data-lines=\"207,208\">Start the <code>backend</code> container:</p>","children":[{"content":"\n<pre><code class=\"language-sh\">  docker compose up -d backend\n</code></pre>","children":[],"payload":{"lines":"208,211"}}],"payload":{"lines":"207,211"}},{"content":"\n<p data-lines=\"211,212\">Check if the container is running:</p>","children":[{"content":"\n<pre><code class=\"language-sh\">  docker ps -a\n</code></pre>","children":[],"payload":{"lines":"212,216"}}],"payload":{"lines":"211,216"}},{"content":"\n<p data-lines=\"216,217\">Check database</p>","children":[{"content":"\n<pre><code class=\"language-sh\">  docker <span class=\"hljs-built_in\">exec</span> -it pgdb psql -U postgres\n  \\dt\n</code></pre>","children":[],"payload":{"lines":"217,221"}}],"payload":{"lines":"216,221"}},{"content":"\n<p data-lines=\"221,222\">Make migration</p>","children":[{"content":"\n<pre><code class=\"language-sh\">  docker <span class=\"hljs-built_in\">exec</span> -it backend npx prisma migrate dev --name init\n</code></pre>","children":[],"payload":{"lines":"222,225"}},{"content":"\n<pre><code class=\"language-sh\">  docker <span class=\"hljs-built_in\">exec</span> -it pgdb psql -U postgres\n  \\dt\n</code></pre>","children":[],"payload":{"lines":"225,230"}}],"payload":{"lines":"221,230"}}],"payload":{"lines":"144,145"}},{"content":"Testing","children":[{"content":"will add users in 3 different ways.","children":[{"content":"add user using <code>Prisma Studio</code>","children":[{"content":"\n<pre><code class=\"language-sh\">  <span class=\"hljs-built_in\">cd</span> &lt;project_folder&gt;/backend/\n  npx prisma studio\n</code></pre>","children":[],"payload":{"lines":"233,237"}},{"content":"This will open Prisma Studio in your browser at <code>http://localhost:5555</code>","children":[],"payload":{"lines":"237,238"}},{"content":"(Note: we are not using Docker to run Prisma Studio, we are running it directly on our machine).","children":[],"payload":{"lines":"238,239"}},{"content":"Add a record: <code>Aung Thu Oo</code> and <code>example@gmail.com</code>","children":[],"payload":{"lines":"239,240"}},{"content":"hit <code>Save 1 change</code>. You can leave Prisma Studio open in a tab, we will use it later.","children":[],"payload":{"lines":"240,241"}},{"content":"If we make an http request to <code>http://localhost:4000/users</code> we should see 1 user (the one we just created using Prisma Studio).","children":[{"content":"\n<pre><code class=\"language-json\"><span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">\"id\"</span> <span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"1\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"name\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"Aung Thu Oo\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"email\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"example@gmail.com\"</span>\n<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n</code></pre>","children":[],"payload":{"lines":"242,249"}}],"payload":{"lines":"241,249"}}],"payload":{"lines":"232,249"}},{"content":"add user using <code>Postman</code>","children":[],"payload":{"lines":"249,250"}},{"content":"add user using <code>psql</code>","children":[{"content":"Let's insert another user using <code>psql</code>.","children":[],"payload":{"lines":"251,252"}},{"content":"\n<pre><code class=\"language-sh\">  <span class=\"hljs-built_in\">cd</span> &lt;project_folder&gt;/\n  docker <span class=\"hljs-built_in\">exec</span> -it pgdb psql -U postgres\n  \\dt\n</code></pre>","children":[],"payload":{"lines":"252,257"}},{"content":"\n<pre><code class=\"language-sql\">  <span class=\"hljs-keyword\">insert</span> <span class=\"hljs-keyword\">into</span> \"User\" (name, email) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-string\">'ATO developer'</span>, <span class=\"hljs-string\">'atodev@gmail.com'</span>);\n  <span class=\"hljs-keyword\">select</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">from</span> \"User\";\n</code></pre>","children":[],"payload":{"lines":"257,261"}},{"content":"check again on <code>Prisma Studio</code>, and we should see new users now:","children":[],"payload":{"lines":"261,264"}}],"payload":{"lines":"250,264"}}],"payload":{"lines":"231,264"}}],"payload":{"lines":"230,231"}},{"content":"Ref: https://dev.to/francescoxx/javascript-fullstack-web-app-nextjs-docker-4d44","children":[],"payload":{"lines":"264,265"}}]},{"colorFreezeLevel":2,"collapsed":false,"nodeMinHeight":30,"initialExpandLevel":2})</script>
</body>
</html>
